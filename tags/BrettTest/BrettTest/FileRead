/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package jung1;

import java.io.*;
import java.util.*;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JOptionPane;


/**
 *
 * @author Brett
 */
public class FileRead {
    
public File FileChooser(){
        //notification of file open
        JFrame notification = new JFrame();
        JOptionPane.showMessageDialog(notification,"Please selet a test file created by VMPowerScript");
        //new frame, starts at jar directory
        JFrame openFrame = new JFrame();
        JFileChooser file = new JFileChooser(".");
        int openChoice = file.showOpenDialog(openFrame);        
        File selectedFile = null;
        
        
        if (openChoice == JFileChooser.APPROVE_OPTION)
        {
            selectedFile = file.getSelectedFile();
            System.out.print(selectedFile + " read Succesfully \n");
        }
        else
        {
            JFrame failure = new JFrame();
            JOptionPane.showMessageDialog(failure, "Failed to load file. Now terminating");  
            System.exit(1);
        }
        
        return selectedFile;
    }     
    
    
    /**
     *
     * @param ChosenFile
     */
public void FileRead(Map<String, NodeData> NodeTable, Map<String, EdgeData> EdgeTable)        
{   
    BufferedReader br = null;
   
    try 
    {
        //Varibles to use could be cut down some 
        String sCurrentLine;
        String NodeHashID;
        String EdgeHashID;
        String NodeName;
        String NodeF1;
        String NodeF2;
        String NodeF3;
        Integer NodeCount = 0;
        Integer EdgeCount = 0;
   
        //File Chooser does nothing if null (2nd safety check)
        if((br = new BufferedReader(new FileReader(FileChooser()))) != null);
   
        while ((sCurrentLine = br.readLine()) != null) 
        {                     
            if( sCurrentLine.compareTo("<node>") == 0)
            {                    
                /* <Node> tag Contains the following
                 *   Name - string
                 *   SwitchID - string
                 *   Status - string
                 *   Address - string
                 */
                   
                //Node Initialization
//              NodeTable.put(Name String, generated ID, Status String);
                   
                //iterate nodecount
                NodeCount++;       
                    
                //Name Read
                sCurrentLine = br.readLine();
                //System.out.println(sCurrentLine);
                NodeName = sCurrentLine.toLowerCase();                         
                   
                //ID Read (Field 1)
                sCurrentLine = br.readLine();
                NodeF1 = sCurrentLine;
                   
                //Status Read (Field 2)
                sCurrentLine = br.readLine();
                NodeF2 = sCurrentLine;
                   
                //Address Read (Field 3)
                sCurrentLine = br.readLine();
                NodeF3 = sCurrentLine;
                   
                   
                //Setups up node and outputs the fields of the read node for checking purposes
                NodeHashID = "node" + String.valueOf(NodeCount);
                NodeTable.put(NodeHashID, new NodeData(NodeName, NodeF1, NodeF2, NodeF3));
                NodeTable.get(NodeHashID).nodePrint();
//                System.out.println("Node ID: " + NodeTable.get(NodeHashID).getID());
//                System.out.println("Node Name: " + NodeTable.get(NodeHashID).getName());
//                System.out.println("Node Address: " + NodeTable.get(NodeHashID).getAddress());
//                System.out.println("Node Status: " + NodeTable.get(NodeHashID).getStatus() + "\n");
                 
            } //End <node> Tag
                         
               
            if(sCurrentLine.compareTo("<edge>") == 0)
            {               
                sCurrentLine = br.readLine();
                                              
                String[] tokens;
                
                while(sCurrentLine.compareTo("<<>>") != 0)
                {
                    EdgeCount++;
                    tokens = sCurrentLine.split(",");
                    
                    //Setups up node and outputs the fields of the read node for checking purposes
                    EdgeHashID = "edge" + String.valueOf(EdgeCount);
                    EdgeTable.put(EdgeHashID, new EdgeData(EdgeCount, tokens[0].toLowerCase(), tokens[1].toLowerCase()));
                    System.out.println("Edge " + EdgeCount + " Is connected between: " + EdgeTable.get(EdgeHashID).getParent() + " and " + EdgeTable.get(EdgeHashID).getChild());
                    
                    sCurrentLine = br.readLine();
                }//end edge loop
            }//end <edge> tag
        }//end while
   
    }//end try
    
    catch (IOException e) 
    {
    } 
    
    finally 
    {
        try 
        {
            if (br != null) 
            {
                br.close();
            }
        } 
        catch (IOException ex) {}
    }  
}
}
